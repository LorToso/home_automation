switch_to_option_or_off:
  alias: Switch to option or off
  fields:
    input_select:
      description: "Input select to set"
      example: "input_select.home_screen_settings"
    option:
      description: "The option to select"
      example: "simple"
  sequence:
    - service: input_select.select_option
      data_template:
        entity_id: "{{ input_select }}"
        option: >
         {% if states(input_select) == option %}
          off
         {% else %}
          {{ option }}
         {% endif %}

leaving_the_house:
  alias: Leaving the house
  icon: mdi:door-open
  sequence:
    - service: script.turn_off_everything
    - service: script.turn_on_all_presence_locks

turn_off_everything:
  alias: Turn Off Everything
  icon: mdi:door-open
  sequence:
  - service: script.turn_off_lights
  - service: script.turn_off_all_presences
  - service: script.turn_off_all_presence_locks
  - service: script.turn_off_all_music
  - service: homeassistant.turn_off
    target:
      entity_id: humidifier.humidifier
  - if:
      - condition: state
        entity_id: input_boolean.automate_heating
        state: "on"
    then:
      - service: script.set_heating_to_auto
      - service: script.set_heating_to_away_mode

  - service: input_boolean.turn_off
    target:
      entity_id:
        - input_boolean.work_mode
        - input_boolean.night_mode
  mode: single

turn_off_lights:
  alias: Turn Off Lights
  sequence:
  - if:
    - condition: state
      entity_id: "input_boolean.guest_mode"
      state: "off"
    then:
      - service: light.turn_off
        target:
          entity_id: 'all'
      - service: switch.turn_off
        target:
          entity_id:
            - switch.entrance_lamp
            - switch.fairy_light
            - switch.bath_room_switch
    else:
      - service: homeassistant.turn_off
        target:
          entity_id:
            - light.night_lamp
            - switch.night_lamp_2
            - light.bar_lamp
            - light.corner_lamp
            - light.couch_lamp
            - light.retro_lamp
            - switch.fairy_light
            - light.kitchen_lamp
            - switch.entrance_lamp
            - light.toilet_lamp
            - input_boolean.kitchen_scene_set
            - input_boolean.living_room_scene_set

  mode: single

turn_off_all_presences:
  alias: Turn Off All Presences
  sequence:
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.bar_presence
          - input_boolean.bath_room_presence
          - input_boolean.bed_room_presence
          - input_boolean.hallway_presence
          - input_boolean.kitchen_presence
          - input_boolean.living_room_presence
          - input_boolean.office_presence
          - input_boolean.toilet_presence
          - input_boolean.entrance_presence
          - input_boolean.dining_room_presence
  mode: single

turn_off_all_music:
  alias: Turn Off All Music
  sequence:
    - service: media_player.media_pause
      target:
        entity_id:
          - media_player.kitchen_speaker
          - media_player.living_room_speaker
          - media_player.bath_room_speaker
          - media_player.office_speaker
          - media_player.bed_room_speaker
    - service: media_player.turn_off
      target:
        entity_id: media_player.lg_tv

  mode: single

say_goodbye:
  alias: Say goodbye in the kitchen
  sequence:
    - service: tts.cloud_say
      data:
        entity_id: media_player.kitchen_speaker
        message: Goodbye
        cache: true
    - delay:
        seconds: 3

set_trash_reminder:
  alias: Sets a trash reminder
  sequence:
    - if:
        - condition: state
          entity_id: input_boolean.trash_reminder
          state: "off"
      then:
        - service: input_boolean.turn_on
          target:
            entity_id:
              - input_boolean.trash_reminder
        - service: tts.cloud_say
          data:
            entity_id: media_player.kitchen_speaker
            message: Set trash reminder
            cache: true
        - delay:
            seconds: 3
      else:
        - service: input_boolean.turn_off
          target:
            entity_id:
              - input_boolean.trash_reminder
        - service: tts.cloud_say
          data:
            entity_id: media_player.kitchen_speaker
            message: Removed trash reminder
            cache: true
        - delay:
            seconds: 3

remind_about_trash:
  alias: Remind the user to take the trash out if the reminder has been set
  sequence:
    - if:
        - condition: state
          entity_id: input_boolean.trash_reminder
          state: "on"
      then:
        - service: tts.cloud_say
          data:
            entity_id: media_player.kitchen_speaker
            message: Remember to take out the trash
            cache: true
        - delay:
            seconds: 3
        - service: input_boolean.turn_off
          target:
            entity_id:
              - input_boolean.trash_reminder

remind_umbrella:
  alias: Tell the user if it's going to rain
  sequence:
    - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: sensor.when_will_it_rain_today
            state: "0"
      then:
        - service: tts.cloud_say
          data_template:
            entity_id: media_player.kitchen_speaker
            message: '{{ states("sensor.when_will_it_rain_today") }}'
            cache: true

remind_important_items:
  alias: Tell the user to pack important items
  sequence:
    - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: person.lorenzo
            state: "home"
      then:
        - service: tts.cloud_say
          data:
            entity_id: media_player.kitchen_speaker
            message: "Don't forget to pack your phone, keys and wallet."
            cache: true