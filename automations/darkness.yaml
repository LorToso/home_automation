- id: 'darkness_off_after_sunrise'
  alias: Darkness off after sunrise
  description: ''
  trigger:
  - platform: state
    entity_id: sun.sun
  condition:
  - condition: sun
    after: sunrise
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: darkness

- id: 'darkness_on_after_sunset'
  alias: Darkness on after sunset
  description: ''
  trigger:
  - platform: state
    entity_id: sun.sun
  condition:
  - condition: sun
    after: sunset
    after_offset: "-00:30:00"
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: darkness

- id: 'darkness_on_after_sunset'
  alias: Darkness on after sunset
  description: ''
  trigger:
  - platform: state
    entity_id: sun.sun
  condition:
  - condition: sun
    after: sunset
    after_offset: "-00:30:00"
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: darkness

- id: 'darkness_on_based_on_sensors'
  alias: Darkness on based on sensors
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.entrance_light
    - sensor.bar_light
    - sensor.bath_room
  condition:
  - condition: sun
    before: sunset
    before_offset: "-01:30:00"
  - condition: numeric_state
    entity_id: sensor.entrance_light
    below: 60
  - condition: numeric_state
    entity_id: sensor.bar_light
    below: 35
  - condition: numeric_state
    entity_id: sensor.bath_room_light
    below: 140
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: darkness

- id: 'track_darkness'
  alias: Track darkness
  description: ''
  trigger:
  - platform: state
    entity_id: sun.sun
  - platform: state
    entity_id: weather.home
  condition: []
  action:
  - choose:
    - conditions:
      - condition: sun
        after: sunset
        after_offset: "-00:30:00"
      sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: darkness
    - conditions:
      - condition: sun
        before: sunrise
      sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: darkness
    - conditions:
      - condition: and
        conditions:
        - condition: state
          entity_id: weather.home
          state: cloudy
        - condition: sun
          after: sunset
          after_offset: "-01:30:00"
      sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: darkness
    default:
    - service: input_boolean.turn_off
      target:
        entity_id: darkness
  mode: single