- id: 'track_darkness'
  alias: Track darkness
  description: ''
  trigger:
  - platform: state
    entity_id: sun.sun
  - platform: state
    entity_id: weather.home
  condition: []
  action:
  - choose:
    - conditions:
      - condition: sun
        after: sunset
        after_offset: "-00:30:00"
      sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.it_is_dark
    - conditions:
      - condition: sun
        before: sunrise
      sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.it_is_dark
    - conditions:
      - condition: state
        entity_id: weather.home
        state: cloudy
      sequence:
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.it_is_dark
    default:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.it_is_dark
  mode: single